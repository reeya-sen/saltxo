class QuickAdd extends HTMLElement{static forms={};constructor(){super()}connectedCallback(){this.button=this.querySelector(".product--quick-add--button"),this.handle=this.dataset.handle,this.query="?section_id=product--quick-add--form&variant="+this.dataset.id,this.button.on("click",async t=>{t.preventDefault(),this.setAttribute("aria-busy",!0),"true"===this.dataset.form?await this.showForm():await this.addToCart(),this.setAttribute("aria-busy",!1)})}async showForm(){let e=!0;if(Object.keys(QuickAdd.forms).forEach(t=>{QuickAdd.forms[t].style.display=t===this.handle?"block":"none",t===this.handle&&(e=!1)}),e){var t=await fetch(`${theme.urls.root}/products/${this.handle}/`+this.query);if(!t.ok)throw this.setAttribute("data-loading",!1),new Error(t.status);var a=(await t.text()).parse(".product--quick-add--form");QuickAdd.forms[this.handle]=a,theme.drawer.querySelector('[data-view="product-form"]').appendChild(a)}theme.utils.updateRecentProducts(this.handle),theme.drawer.open("right","product-form",this)}async addToCart(){if(theme.utils.getQuantity(this.dataset.id,this.dataset,1)){var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:[{id:this.dataset.id,quantity:1}]})};try{await theme.cart.addItems(t,this.dataset.id),theme.drawer.open("right","cart-drawer",this.button)}catch(t){throw this.setAttribute("data-loading",!1),new Error(t)}}}static clearFormListeners(){window.on("theme:navigation:reloaded theme:search:reloaded",()=>{Object.keys(QuickAdd.forms).forEach(t=>QuickAdd.forms[t].remove()),QuickAdd.forms={}})}}theme.quick_add=QuickAdd,theme.quick_add.clearFormListeners(),customElements.define("product-quick-add",QuickAdd);