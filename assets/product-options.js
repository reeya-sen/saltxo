class ProductOptions extends HTMLElement{constructor(){super()}connectedCallback(){this.current_product_url=this.getAttribute("data-product-url"),this.handle=this.getAttribute("data-product-handle"),this.inputs=this.querySelectorAll("input"),this.is_product_page=null!==this.closest(".product-page--root"),this.is_quick_add=null!==this.closest(".product--quick-add--form"),this.options=this.querySelectorAll("label[data-option-value-id], li[data-option-value-id]"),this.product_id=this.getAttribute("data-product-id"),this.section_root=this.is_quick_add?this.closest(".product--quick-add--form"):this.closest("[data-section-id]"),this.section_id=this.is_quick_add?"product--quick-add--form":this.section_root.getAttribute("data-section-id"),theme.variant_caches[this.section_id]=theme.variant_caches[this.section_id]||{},this.cache=theme.variant_caches[this.section_id],this.setCurrentOptions(),this.initSizeChart(),this.optionChangeListener(),this.loadVariantObserver(),this.preventFormSubmitOnEnter(),Shopify.designMode&&this.editorListeners()}initSizeChart(){var t=this.querySelector(".product-options--option .product-size-chart--root");t&&(t.parentNode.querySelector("label").parentNode.appendChild(t),t.removeAttribute("style"))}optionChangeListener(){this.querySelectorAll('[data-item="disclosure"], [data-item="radio"]').on("change.ProductOptions",async({target:t})=>{this.setAttribute("aria-busy",!0),this.setCurrentOptions();var e,i,a,r,s=this.generateCacheKey(this.current_options),o=t.getAttribute("data-product-url");let n;this.cache[s]?n=await this.cache[s]:(n=await this.fetchData(o,this.current_options),this.cache[s]=n),""!==o&&o!=this.current_product_url?(e=n.firstChild,this.section_root.parentNode.replaceChild(e,this.section_root),this.is_quick_add&&theme.quick_add?((i=e.getAttribute("data-handle"))&&(theme.quick_add.forms[i]=e),delete theme.quick_add.forms[this.handle]):(theme.transitions.reload("viewport"),Shopify.PaymentButton&&Shopify.PaymentButton.init(),this.is_product_page&&history.replaceState({path:o},"",o))):(a=n.querySelector(".product-options--root"),this.outerHTML=a.outerHTML,r=JSON.parse(a.querySelector("[id*=variant-json]").innerHTML),this.updateVariant(r||!1))})}loadVariantObserver(){new IntersectionObserver(([{isIntersecting:t}],e)=>{t&&(this.loadVariantHtml(),e.disconnect())},{threshold:0}).observe(this)}loadVariantHtml(){this.options.forEach(t=>{const e={value_id:t.getAttribute("data-option-value-id"),name:t.getAttribute("data-option-name")};var i=this.current_options.map(t=>t.name===e.name?e:t),a=this.generateCacheKey(i),r=t.getAttribute("data-product-url");this.cache[a]||(this.cache[a]=this.fetchData(r,i))})}setCurrentOptions(){var t=this.querySelectorAll('[data-item="disclosure"], [data-item="radio"]:checked');this.current_options=[...t].map(t=>({value_id:t.getAttribute("data-option-value-id"),name:t.getAttribute("data-option-name")}))}generateCacheKey(t){return t.map(t=>t.value_id).join("_")}async fetchData(t,e){var i=""===t?this.current_product_url:t,a=e.map(t=>t.value_id).join(","),r=await fetch(`${i}?section_id=${this.section_id}&option_values=`+a);return r.ok?(await r.text()).parse():null}preventFormSubmitOnEnter(){this.inputs.length&&this.inputs.on("keydown",t=>"Enter"===t.key&&t.preventDefault())}updateVariant(t){this.is_product_page&&this.updateHistoryState(t),window.trigger(`theme:product:${this.dataset.id}:variantChanged`,{variant:t})}updateHistoryState(t){let e=location.pathname;t&&(e+="?variant="+t.id),history.replaceState({path:e},"",e)}editorListeners(){var t=this.closest("[data-shopify-editor-block]");t&&t.on("theme:block:select",()=>{theme.variant_caches[this.section_id]={},this.cache=theme.variant_caches[this.section_id]})}}const productOptionsEl=customElements.get("product-options-root");productOptionsEl||customElements.define("product-options-root",ProductOptions);